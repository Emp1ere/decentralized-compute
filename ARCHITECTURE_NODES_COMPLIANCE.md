# Соответствие архитектуры узлов критериям распределённой системы

Проверка по заданным пунктам для группы оркестраторских узлов (orchestrator_node_1, orchestrator_node_2).

---

## 1. «Группа независимых узлов, скоординированно взаимодействующих друг с другом для достижения общего результата. Для конечного пользователя группа выглядит как единая система.»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Независимые узлы | Два контейнера (orchestrator_node_1, orchestrator_node_2), один и тот же код, но отдельные процессы; каждый сам решает, когда синхронизироваться и создавать блок. | ✅ Да |
| Скоординированное взаимодействие | Синхронизация цепочки (GET /chain, replace_chain_from_peer), синхронизация pending (GET /pending), приём/пересылка блоков (POST /receive_block). Консенсус: longest valid chain. | ✅ Да |
| Общий результат | Единая согласованная цепочка блоков и балансы; пользователь получает задачи и сдаёт работу «в систему», а не в конкретный узел. | ✅ Да |
| Выглядит как единая система | Доступ через балансировщик (localhost:8080) или напрямую к узлам; один дашборд, один набор контрактов и балансов после синхронизации. | ✅ Да |

**Итог по пункту 1:** соответствует.

---

## 2. «Узлы программируемые, асинхронные, автономные и не подверженные сбоям.»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Программируемые | Один и тот же код (app.py, blockchain.py, contracts.py), поведение задаётся конфигом (PEER_URL, NODE_ID, SYNC_INTERVAL). | ✅ Да |
| Асинхронные | Обработка запросов неблокирующая (Flask); синхронизация с пиром в фоне (periodic_sync в отдельном потоке); запросы к пиру по HTTP без ожидания ответа для продолжения работы. | ✅ Да |
| Автономные | Каждый узел сам решает, когда вызывать sync_chain_from_peer(), когда создавать блок при submit_work; не нужен внешний дирижёр. | ✅ Да |
| Не подверженные сбоям | Нет явной отказоустойчивости: падение одного узла оставляет только второй; при падении обоих система недоступна. Нет рестартов в docker-compose по умолчанию (restart закомментирован). | ⚠️ Частично: узлы могут падать, резервирования «один из двух» достаточно для базовой устойчивости, но явной fault-tolerance (health checks, автопереключение) нет. |

**Итог по пункту 2:** в основном соответствует; «не подверженные сбоям» — частично (зависит от интерпретации: два узла дают резерв, но без автоматического восстановления).

---

## 3. «У каждого узла есть собственная память и процессор. Они имеют общие состояния и могут работать одновременно.»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Собственная память | У каждого процесса свой экземпляр Blockchain в RAM (цепочка, pending_transactions, balances). | ✅ Да |
| Собственный процессор | Отдельный процесс (контейнер) на каждый узел; свои потоки (Flask, periodic_sync). | ✅ Да |
| Общие состояния | Цепочка и балансы согласуются через синхронизацию (longest valid chain); после sync оба узла приходят к одному и тому же состоянию цепочки. | ✅ Да |
| Одновременная работа | Оба узла могут одновременно обслуживать запросы, синхронизироваться с пиром и (при распределённом трафике) создавать блоки. | ✅ Да |

**Замечание:** постоянное хранилище (data/chain.json, users.json) в текущей конфигурации общее для обоих узлов (один том в docker-compose). То есть «собственная память» — про оперативную; персистентность частично общая. Для двух узлов это допустимо; при расхождении цепочки приоритет у состояния, полученного по сети (replace_chain_from_peer), а не только у файла на диске.

**Итог по пункту 3:** соответствует.

---

## 4. «Узлы соединяются друг с другом, чтобы предоставлять услуги, обмениваться данными или просто хранить данные (например, в блокчейне).»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Соединяются друг с другом | Каждый узел знает пира через PEER_URL (node_1 → node_2, node_2 → node_1). | ✅ Да |
| Предоставлять услуги | Каждый узел предоставляет API: get_task, submit_work, get_balance, register, chain, pending, receive_block и т.д.; пользователь/воркер может обращаться к любому узлу (через балансировщик или напрямую). | ✅ Да |
| Обмениваться данными | GET /chain, GET /pending — запрос данных у пира; POST /receive_block — отправка блока пиру; POST /receive_chain, POST /add_pending_tx — приём данных от пира. | ✅ Да |
| Хранить данные (блокчейн) | Каждый узел хранит локальную копию цепочки и балансов; консенсус и синхронизация обеспечивают согласованное «общее» состояние блокчейна. | ✅ Да |

**Итог по пункту 4:** соответствует.

---

## 5. «Все узлы взаимодействуют друг с другом с помощью сообщений.»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Взаимодействие через сообщения | Взаимодействие только по HTTP (JSON): запросы и ответы — сообщения. Нет общей разделяемой памяти между процессами. | ✅ Да |
| Типы сообщений | Запрос цепочки (GET /chain), запрос pending (GET /pending), отправка блока (POST /receive_block), отправка цепочки (POST /receive_chain), отправка транзакций (POST /add_pending_tx). | ✅ Да |

**Итог по пункту 5:** соответствует.

---

## 6. «Все узлы распределенной системы могут отправлять и получать сообщения друг от друга.»

| Аспект | В проекте | Соответствие |
|--------|------------|--------------|
| Отправка сообщений | Узел 1 отправляет пиру (узлу 2): GET /chain, GET /pending, POST /receive_block. Узел 2 отправляет пиру (узлу 1): то же. | ✅ Да |
| Получение сообщений | Каждый узел принимает POST /receive_block, POST /receive_chain, POST /add_pending_tx (с проверкой X-Node-Secret); отвечает на GET /chain, GET /pending. | ✅ Да |
| Симметрия | Оба узла в паре равноправны по коду: оба могут инициировать GET к пиру и оба принимают POST от пира. | ✅ Да |

**Замечание:** при трёх и более узлах в текущей схеме у каждого узла только один PEER_URL, то есть топология «цепочка» или «звезда», а не полный граф «каждый с каждым». Для двух узлов условие «все могут отправлять и получать друг от друга» выполняется.

**Итог по пункту 6:** для текущей конфигурации (два узла) соответствует.

---

## Сводная таблица

| Критерий | Соответствие |
|----------|--------------|
| 1. Независимые узлы, координация, общий результат, единая система для пользователя | ✅ Соответствует |
| 2. Программируемые, асинхронные, автономные, не подверженные сбоям | ✅ В основном; устойчивость к сбоям — частично |
| 3. Собственные память и процессор, общее состояние, работа одновременно | ✅ Соответствует |
| 4. Соединение для услуг, обмена данными и хранения (блокчейн) | ✅ Соответствует |
| 5. Взаимодействие с помощью сообщений | ✅ Соответствует |
| 6. Все узлы могут отправлять и получать сообщения друг от друга | ✅ Соответствует (для двух узлов) |

---

## Рекомендации для ещё более полного соответствия

- **П.2 (устойчивость):** включить `restart: unless-stopped` для контейнеров узлов; при необходимости добавить healthcheck и мониторинг доступности узлов.
- **П.6 при N > 2:** при добавлении третьего узла и далее рассмотреть либо несколько PEER_URL (или список пиров), либо топологию, при которой каждый узел может обмениваться сообщениями со всеми остальными (или с выбранным подмножеством), чтобы критерий «все со всеми» выполнялся в желаемой мере.

В целом архитектура узлов соответствует заданным критериям распределённой системы для текущей конфигурации из двух оркестраторских узлов.
