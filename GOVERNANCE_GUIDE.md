# Руководство по Управлению сетью

Раздел «Управление сетью» в дашборде предназначен для подключения узлов, добавления валидаторов и обновления версии протокола.

## 1. Назначение раздела

- **Подключение узлов** — добавление новых оркестраторов в управляемую сеть
- **Валидаторы** — назначение пользователей для независимой проверки результатов вычислений
- **Обновление протокола** — поэтапный rollout новой версии между узлами

## 2. Статус сети

Кнопка **«Показать статус сети»** обновляет:

| Поле | Описание |
|------|----------|
| Версия протокола | Текущая версия, под которой работает узел |
| Подключено узлов | Количество допущенных узлов |
| Подключено валидаторов | Количество допущенных валидаторов |
| Статус обновления | Состояние активного rollout (если есть) |

## 3. Добавление валидатора

1. Введите **ID пользователя** (client_id), которого нужно сделать валидатором
2. Если на сервере включён admission token — укажите его в поле **Admission token**
3. Нажмите **«Добавить валидатора»**

Валидатор участвует в разрешении спорных результатов при репликации (replication groups).

## 4. Добавление узла в сеть

1. Введите **ID узла** (например `orchestrator_node_2`)
2. При необходимости укажите **Admission token**
3. Нажмите **«Добавить узел»**

Узел будет добавлен в список допущенных. Синхронизация блокчейна и jobs выполняется через `PEER_URL` и эндпоинты `/receive_chain`, `/jobs/snapshot`.

## 5. Обновление версии протокола

Цепочка из трёх шагов:

1. **Предложить обновление** — выберите версию из списка, задайте минимум подтверждений (обычно = число узлов), нажмите «Предложить обновление»
2. **Подтвердить** — каждый узел нажимает «Подтвердить» (ack)
3. **Финализировать** — после набора требуемых подтверждений нажмите «Финализировать»

Количество подтверждений должно быть не меньше числа узлов для консенсуса.

## 6. Решение валидатора по группе репликации

При спорных или неоднозначных результатах:

1. Введите **ID группы репликации** (replication_group_id)
2. Выберите решение: **Принять результат** или **Отклонить результат**
3. При необходимости добавьте комментарий
4. Нажмите **«Отправить решение»**

## 7. Аргументация MVP (claims, demo-script)

Блок «Аргументация MVP» содержит:

- **claims** — структурированные утверждения о proof-points системы
- **demo-script** — сценарий демонстрации для разработки

Кнопка **«Подготовить demo-данные»** — только для dev-окружения.

---

## Оценка жизнеспособности модели в продакшене

### Текущая архитектура (on-chain governance)

- Состояние governance выводится из блокчейна (транзакции типов `governance_admit_node`, `governance_admit_validator`, `governance_rollout_propose`, `governance_rollout_ack`, `governance_rollout_finalize`)
- Governance реплицируется вместе с цепочкой блоков — тот же консенсус, что и для экономических транзакций
- API создаёт governance-транзакции и добавляет их в pending; они попадают в блок при следующем `submit_work`

### Плюсы

- **Консистентность** — governance реплицируется с гарантией (блокчейн)
- **Консенсус** — admission и rollout проходят через блокчейн; применяется правило «длиннейшая валидная цепочка»
- **Аудит** — все изменения governance зафиксированы в цепочке

### Оставшиеся ограничения

- **Рассинхронизация runtime** — `replication_groups`, `challenges`, `disputes` по-прежнему в `decentralized_runtime.json`
- **Задержка применения** — governance-транзакции применяются при следующем блоке (при `submit_work`)

### Рекомендации для продакшена

1. **Runtime state** — рассмотреть вынос replication/challenges/disputes в блокчейн или распределённое хранилище
2. **Governance-блоки** — опционально: блоки только с governance-транзакциями (без ожидания submit_work)

---

## PoUW и консенсус

**Proof-of-Useful-Work (PoUW)** применяется к **блокчейну аудита** (блоки создаются при верифицированной полезной работе — `submit_work` + `contract.verify`). Это не PoW с перебором nonce.

**Governance** теперь входит в тот же блокчейн: governance-транзакции упаковываются в блоки вместе с `reward` и `work_receipt`. Консенсус: длиннейшая валидная цепочка; все узлы, синхронизировавшие цепочку, имеют одинаковое состояние governance.
